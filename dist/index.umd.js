(function(C,E){typeof exports=="object"&&typeof module<"u"?E(exports,require("vue"),require("axios"),require("fan-utils")):typeof define=="function"&&define.amd?define(["exports","vue","axios","fan-utils"],E):(C=typeof globalThis<"u"?globalThis:C||self,E(C.FanUse={},C.Vue,C.axios,C.fanUtils))})(this,function(C,E,N,b){"use strict";const R={line:"line",middle:"middle",random:"random"},M={static:"static",slowly:"slowly",playing:"playing"},T={n:8,radii:0,initialPosition:R.middle,defaultStatus:M.static,duration:3e3,roundDurationSlowly:5e4},V=w=>{let e,a;const i=E.reactive({itemList:[],itemMaxWidth:0,lineList:[],status:M.static,panStyle:"",panStyleSlowly:""}),d=()=>{i.status!==M.playing&&(e.defaultStatus===M.slowly?i.panStyleSlowly=`animation:fanZhuanpanSlowly ${e.roundDurationSlowly}ms linear infinite`:i.panStyleSlowly="")},o=m=>{if(i.status===M.playing)throw new Error("抽奖转动过程中不允许修改配置项");e={...e,...m},e.defaultStatus!==M.static&&e.defaultStatus!==M.slowly&&(e.defaultStatus=M.static),i.status=e.defaultStatus,s(),d()},n=m=>{const y=m/180*Math.PI;return 2*e.radii*Math.sin(y/2)},s=()=>{a=360/e.n;const m=new Array(e.n).fill(0),y=[];i.itemList=m.map((c,S)=>{const p={offsetDeg:e.initialPosition===R.line?a*S+a/2:a*S};return y.push({offsetDeg:p.offsetDeg+a/2}),p}),i.lineList=y,i.itemMaxWidth=n(a)};(()=>{o({...T,...w})})();let l=!0;const v=()=>{i.panStyle="",d(),l=!0};let u,h;const t=()=>{i.status=e.defaultStatus},r=m=>new Promise((y,c)=>{if(i.status===M.playing)return c(new Error("请等待上一条完成之后再试"));if(!l){v(),setTimeout(()=>{y(r(m))},300);return}l=!1,i.status=M.playing;let S=360*(e.duration*10/T.duration)-m.index*a+(e.initialPosition===R.line?0:a/2)-(e.endPosition===R.middle?a/2:Math.min(a*.8,Math.max(a*.2,a*Math.random())));i.panStyle=`transition:transform ${e.duration}ms;transform:rotate(${S}deg)`,i.panStyleSlowly!==""&&setTimeout(()=>{i.panStyleSlowly=""},e.duration/2),e.useElementEvent?(u=y,h=m):setTimeout(()=>{y(m),t()},e.duration)});return{state:i,ZhuanpanStatus:M,ZhuanpanPosition:R,setOptions:o,play:r,reset:v,onPanEnd:()=>{e.useElementEvent&&u&&(u(h),u=null,h=null,t())}}},D=w=>{const e=E.ref(!0),a=window.requestAnimationFrame,i=window.cancelAnimationFrame;return{rafReadyStatus:e,raf:a,cancelRaf:i,onRafReady:o=>a(o)}},$=(w,...e)=>{console.warn("FanUse:",w,...e)},J=w=>{const{initialValue:e,canvasSelector:a,mp:i,...d}=w||{},{raf:o,cancelRaf:n}=D(),s={duration:800,interval:20,minStep:1,decimal:0},g=E.ref(Number(e)||0),l=c=>{var S;Object.assign(s,{...c,decimal:typeof c.decimal<"u"?c.decimal:typeof c.minStep<"u"?((S=c.minStep.toString().split(".")[1])==null?void 0:S.length)||0:s.decimal})};l(d);let v=0,u=0,h=0,t=0,r=null;const f=()=>{r&&(n(r),r=null)},m=()=>{f(),r=o(()=>{r=null;const c=Date.now(),S=g.value,x=Math.ceil((c-v)/s.interval);let p=Number((u+t*x).toFixed(s.decimal));p=t<0?Math.max(h,p):Math.min(h,p),S!==p&&(g.value=p,w!=null&&w.onChange&&w.onChange(p)),g.value!==h?m():w!=null&&w.onFinish&&w.onFinish()})},y=c=>{const{value:S,...x}=c,p=Number(S);if(isNaN(p)){$("countTo..","请传入合法的value");return}p!==g.value&&(l(x),u=g.value,h=p,v=Date.now(),t=(h-g.value)/Math.ceil(s.duration/s.interval),t=t<0?Math.min(-Math.abs(s.minStep),t):Math.max(Math.abs(s.minStep),t),m())};return E.onUnmounted(()=>f()),{countValue:g,countTo:y}},Z=w=>{const{canvasSelector:e,mp:a,...i}=w||{},{raf:d,cancelRaf:o}=D(),n={time:0,millisecond:!1},s=c=>{Object.assign(n,c)};s(i);let g=i.time;const l=E.reactive({time:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0}),v=(c,S)=>{let x=!0;if(n.millisecond?x=c!==l.time:x=Math.floor(c/1e3)!==Math.floor(l.time/1e3),!x)return;const p=1e3,j=p*60,I=j*60,O=I*24;let q=Math.max(0,c);const L=Math.floor(q/O);q-=O*L;const A=Math.floor(q/I);q-=I*A;const W=Math.floor(q/j);q-=j*W;const F=Math.floor(q/p),z=q-p*F;Object.assign(l,{time:q,days:L,hours:A,minutes:W,seconds:F,milliseconds:z}),!S&&n.onChange&&n.onChange({...l})};v(n.time,!0);let u=0,h=null;const t=()=>{h&&(o(h),h=null)},r=()=>{if(t(),l.time<=0){u=0;return}h=d(()=>{h=null,v(n.time-(Date.now()-u)),l.time>0?r():n.onFinish&&n.onFinish()})},f=()=>{u||(u=Date.now(),r())},m=()=>{t(),n.time=l.time,u=0},y=c=>{m(),u=0,s({time:typeof(c==null?void 0:c.time)>"u"?g:c.time,...c}),g=n.time,v(n.time)};return E.onUnmounted(()=>t()),{current:l,start:f,pause:m,reset:y}};class k extends Error{status;customCode;config;constructor(e){const a=typeof e=="object"?e:{message:e};super(a.message),this.status=a.status,this.customCode=a.customCode,this.config=a.config}}const B=()=>new Promise(()=>null),K=w=>{const e=w||{},a=N.create({timeout:e.timeout||6e4,validateStatus:()=>!0}),i=d=>typeof e.errorInterceptor=="function"?Promise.reject(e.errorInterceptor(d)):Promise.reject(d);return a.interceptors.request.use(async d=>{let o={...d};if(typeof e.requestInterceptor=="function"){let s=e.requestInterceptor(o);b.isPromiseLike(s)&&(s=await s),s&&typeof s=="object"&&(o={...o,...s})}const n=["get","delete"];return(!o.method||n.includes(o.method.toLowerCase())&&o.data&&!o.params)&&(o.params=o.data),o},d=>{const o=`${d.request?"网络异常，请检查是否有网后再试-":""}${d.message||""}`;return i(new k(o))}),a.interceptors.response.use(async d=>{var h;const{config:o,data:n,status:s,headers:g}=d,{rejectErrorCode:l}=o;if(typeof e.validateStatus=="function"?!e.validateStatus(s):s>299){let t="";return(h=e.customCodeSet)!=null&&h.messageKey&&n&&typeof n=="object"&&(t=n[e.customCodeSet.messageKey]),t||(t=`${s>499?"服务忙":"内部错误"}，请稍候重试...`),i(new k({message:t,status:s,config:o}))}let u=n;if(typeof e.responseInterceptor=="function"){let t=e.responseInterceptor({data:n,status:s,config:o,headers:g});if(b.isPromiseLike(t))try{t=await t}catch(r){return i(new k({message:r.message||"系统开小差了",status:s,config:o}))}typeof t<"u"&&(u=t)}if(!u||typeof u!="object")return u;if(l!==!1&&e.customCodeSet){const t=u[e.customCodeSet.key];let r=!0;if(Array.isArray(e.customCodeSet.okValue)?r=e.customCodeSet.okValue.includes(t):r=t===e.customCodeSet.okValue,!r)return i(new k({message:u[e.customCodeSet.messageKey],status:s,customCode:t,config:o}))}return u},d=>{var g,l;if(((g=d.request)==null?void 0:g.status)===0)return B();const{status:o,data:n}=d.response||{};let s;return n&&((l=e.customCodeSet)!=null&&l.messageKey)&&(s=n[e.customCodeSet.messageKey]),i(new k({message:d.message,status:o,customCode:s,config:d.config}))}),{request:a}},_="fanWxJsSdk",G="//res.wx.qq.com/open/js/jweixin-1.6.0.js";let P=b.inBrowser?window.location.href:"";const U=w=>{const{configGetter:e,sdkLoadedUrl:a}=w||{};let i="";a?P=a:P||(P=b.inBrowser?window.location.href:"");const{isWeixin:d,isIos:o}=b.getSystemInfo(),n=new Map,s=(t,r)=>{const f=n.get(t)||[];f.push(r),n.set(t,f)},g=t=>{if(!b.inBrowser)return;const{fn:r,url:f}=t||{},m=f||window.location.href;if(!n.has(m))return;if(!r){n.delete(m);return}const y=n.get(m);if(!y)return;const c=y.findIndex(S=>S===r);c!==-1&&(y.splice(c,1),n.set(m,y))},l=t=>{const r=n.get(t);r&&(r.forEach(f=>f()),g({url:t}))},v=()=>new Promise((t,r)=>{window.wx.ready(()=>t(!0)),window.wx.error(f=>r(new Error(f.errMsg||f.message||JSON.stringify(f))))}),u=async(t,r)=>{if(!b.inBrowser)return;const f=(r==null?void 0:r.url)||window.location.href;try{if(o)await v();else if(f!==i)throw new Error("Need wx.config");t()}catch{s(f,t)}},h=async t=>{if(!b.inBrowser||!d)return;const r=(t==null?void 0:t.configGetter)||e;if(!r)throw new Error("[configGetter] required");let f=window.location.href;window.wx||(await b.loadJs(G,{id:_}),P=window.location.href);let m=!1;o&&!i&&P&&f!==P&&(m=!0,f=P);const y=r({url:f}),{config:c,shareData:S}=b.isPromiseLike(y)?await y:y;let x=!0;if(o&&i)try{await v(),x=!1}catch{}if(x&&(window.wx.config(c),await v()),i=f,S){if(m)return h(t);window.wx.updateTimelineShareData(S),window.wx.updateAppMessageShareData(S)}l(f)};return{configWeixinJs:h,onConfigReady:u,removeReadyCallback:g}},H=w=>b.inBrowser?(window.fanWeixinSdk||(window.fanWeixinSdk=U(w)),window.fanWeixinSdk):{},Y=w=>{let e;const a=(o,n,s)=>{let g=`${n.top||0}px ${n.right||0}px ${n.bottom||0}px ${n.right||0}px`;e=new IntersectionObserver(l=>{l.forEach(v=>{var u;v.isIntersecting&&n.callback&&n.callback({...(u=v.target)==null?void 0:u.dataset})})},{root:s,rootMargin:g}),o.forEach(l=>e.observe(l))};return{observer:async o=>{let n;o.root&&(n=document.querySelectorAll(o.root)[0]);const s=document.querySelectorAll(o.selector);s&&s.length&&a(s,o,n)},disconnect:()=>{e&&e.disconnect()}}};C.RequestError=k,C.ZhuanpanPosition=R,C.ZhuanpanStatus=M,C.useCountDown=Z,C.useCountTo=J,C.useIntersectionObserver=Y,C.useRequest=K,C.useRequestAnimationFrame=D,C.useWeixinJsConfig=H,C.useZhuanpan=V,Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});
