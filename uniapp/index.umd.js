(function(h,C){typeof exports=="object"&&typeof module<"u"?C(exports,require("vue"),require("fan-utils")):typeof define=="function"&&define.amd?define(["exports","vue","fan-utils"],C):(h=typeof globalThis<"u"?globalThis:h||self,C(h.FanUse={},h.Vue,h.fanUtils))})(this,function(h,C,O){"use strict";const D={line:"line",middle:"middle",random:"random"},M={static:"static",slowly:"slowly",playing:"playing"},A={n:8,radii:0,initialPosition:D.middle,defaultStatus:M.static,duration:3e3,roundDurationSlowly:5e4},U=t=>{let e,r;const o=C.reactive({itemList:[],itemMaxWidth:0,lineList:[],status:M.static,panStyle:"",panStyleSlowly:""}),s=()=>{o.status!==M.playing&&(e.defaultStatus===M.slowly?o.panStyleSlowly=`animation:fanZhuanpanSlowly ${e.roundDurationSlowly}ms linear infinite`:o.panStyleSlowly="")},w=S=>{if(o.status===M.playing)throw new Error("抽奖转动过程中不允许修改配置项");e={...e,...S},e.defaultStatus!==M.static&&e.defaultStatus!==M.slowly&&(e.defaultStatus=M.static),o.status=e.defaultStatus,u(),s()},n=S=>{const b=S/180*Math.PI;return 2*e.radii*Math.sin(b/2)},u=()=>{r=360/e.n;const S=new Array(e.n).fill(0),b=[];o.itemList=S.map((l,v)=>{const y={offsetDeg:e.initialPosition===D.line?r*v+r/2:r*v};return b.push({offsetDeg:y.offsetDeg+r/2}),y}),o.lineList=b,o.itemMaxWidth=n(r)};(()=>{w({...A,...t})})();let m=!0;const i=()=>{o.panStyle="",s(),m=!0};let d,c;const a=()=>{o.status=e.defaultStatus},g=S=>new Promise((b,l)=>{if(o.status===M.playing)return l(new Error("请等待上一条完成之后再试"));if(!m){i(),setTimeout(()=>{b(g(S))},300);return}m=!1,o.status=M.playing;let v=360*(e.duration*10/A.duration)-S.index*r+(e.initialPosition===D.line?0:r/2)-(e.endPosition===D.middle?r/2:Math.min(r*.8,Math.max(r*.2,r*Math.random())));o.panStyle=`transition:transform ${e.duration}ms;transform:rotate(${v}deg)`,o.panStyleSlowly!==""&&setTimeout(()=>{o.panStyleSlowly=""},e.duration/2),e.useElementEvent?(d=b,c=S):setTimeout(()=>{b(S),a()},e.duration)});return{state:o,ZhuanpanStatus:M,ZhuanpanPosition:D,setOptions:w,play:g,reset:i,onPanEnd:()=>{e.useElementEvent&&d&&(d(c),d=null,c=null,a())}}},I=(t,...e)=>{console.warn("FanUse:",t,...e)},P=t=>{let e;const r=(t==null?void 0:t.mp)!==!1,o=C.ref(!r||!(t!=null&&t.canvasSelector)),s=i=>setTimeout(i,16.666666666666668,Date.now()),w=i=>r?t!=null&&t.canvasSelector?e.requestAnimationFrame(i):s(i):window.requestAnimationFrame(i),n=i=>r?t!=null&&t.canvasSelector?e.cancelAnimationFrame(i):clearTimeout(i):window.cancelAnimationFrame(i),u=[],f=i=>{if(!r||o.value){i();return}u.push(i)},m=C.getCurrentInstance();return C.onMounted(()=>{t!=null&&t.canvasSelector&&uni.createSelectorQuery().in(m).select(t.canvasSelector).fields({node:!0},i=>{if((i==null?void 0:i.nodeCanvasType)!=="2d"||!i.node){I("useRequestAnimationFrame..","请传入正确的canvasSelector");return}if(e=i.node,o.value=!0,u.length){for(let d=0;d<u.length;d++)u[d]();u.length=0}}).exec()}),{rafReadyStatus:o,raf:w,cancelRaf:n,onRafReady:f}},Z=t=>{const{initialValue:e,canvasSelector:r,mp:o,...s}=t||{},{raf:w,cancelRaf:n}=P({canvasSelector:r,mp:o}),u={duration:800,interval:20,minStep:1,decimal:0},f=C.ref(Number(e)||0),m=l=>{var v;Object.assign(u,{...l,decimal:typeof l.decimal<"u"?l.decimal:typeof l.minStep<"u"?((v=l.minStep.toString().split(".")[1])==null?void 0:v.length)||0:u.decimal})};m(s);let i=0,d=0,c=0,a=0,g=null;const q=()=>{g&&(n(g),g=null)},S=()=>{q(),g=w(()=>{g=null;const l=Date.now(),v=f.value,R=Math.ceil((l-i)/u.interval);let y=Number((d+a*R).toFixed(u.decimal));y=a<0?Math.max(c,y):Math.min(c,y),v!==y&&(f.value=y,t!=null&&t.onChange&&t.onChange(y)),f.value!==c?S():t!=null&&t.onFinish&&t.onFinish()})},b=l=>{const{value:v,...R}=l,y=Number(v);if(isNaN(y)){I("countTo..","请传入合法的value");return}y!==f.value&&(m(R),d=f.value,c=y,i=Date.now(),a=(c-f.value)/Math.ceil(u.duration/u.interval),a=a<0?Math.min(-Math.abs(u.minStep),a):Math.max(Math.abs(u.minStep),a),S())};return C.onUnmounted(()=>q()),{countValue:f,countTo:b}},$=t=>{const{canvasSelector:e,mp:r,...o}=t||{},{raf:s,cancelRaf:w}=P({canvasSelector:e,mp:r}),n={time:0,millisecond:!1},u=l=>{Object.assign(n,l)};u(o);let f=o.time;const m=C.reactive({time:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0}),i=(l,v)=>{let R=!0;if(n.millisecond?R=l!==m.time:R=Math.floor(l/1e3)!==Math.floor(m.time/1e3),!R)return;const y=1e3,p=y*60,F=p*60,V=F*24;let T=Math.max(0,l);const j=Math.floor(T/V);T-=V*j;const k=Math.floor(T/F);T-=F*k;const L=Math.floor(T/p);T-=p*L;const N=Math.floor(T/y),_=T-y*N;Object.assign(m,{time:T,days:j,hours:k,minutes:L,seconds:N,milliseconds:_}),!v&&n.onChange&&n.onChange({...m})};i(n.time,!0);let d=0,c=null;const a=()=>{c&&(w(c),c=null)},g=()=>{if(a(),m.time<=0){d=0;return}c=s(()=>{c=null,i(n.time-(Date.now()-d)),m.time>0?g():n.onFinish&&n.onFinish()})},q=()=>{d||(d=Date.now(),g())},S=()=>{a(),n.time=m.time,d=0},b=l=>{S(),d=0,u({time:typeof(l==null?void 0:l.time)>"u"?f:l.time,...l}),f=n.time,i(n.time)};return C.onUnmounted(()=>a()),{current:m,start:q,pause:S,reset:b}};class E extends Error{status;customCode;config;constructor(e){const r=typeof e=="object"?e:{message:e};super(r.message),this.status=r.status,this.customCode=r.customCode,this.config=r.config}}const x=t=>{const e=t||{};return{request:async o=>{var w;let s={timeout:e.timeout||6e4,...o};if(typeof e.requestInterceptor=="function"){let n=e.requestInterceptor(s);O.isPromiseLike(n)&&(n=await n),n&&(s={...s,...n})}s.headers&&!s.header&&(s.header=s.headers);try{const n=await uni.request(s),{data:u,statusCode:f,header:m}=n,{rejectErrorCode:i}=s;if(typeof e.validateStatus=="function"?!e.validateStatus(f):f>299){let a="";throw(w=e.customCodeSet)!=null&&w.messageKey&&u&&typeof u=="object"&&(a=u[e.customCodeSet.messageKey]),a||(a=`${f>499?"服务忙":"内部错误"}，请稍候重试...`),new E({message:a,status:f,config:s})}let c=u;if(typeof e.responseInterceptor=="function"){let a=e.responseInterceptor({data:u,status:f,config:o,headers:m});if(O.isPromiseLike(a))try{a=await a}catch(g){throw new E({message:g.message||"系统开小差了",status:f,config:s})}typeof a<"u"&&(c=a)}if(!c||typeof c!="object")return c;if(i!==!1&&e.customCodeSet){const a=c[e.customCodeSet.key];let g=!0;if(Array.isArray(e.customCodeSet.okValue)?g=e.customCodeSet.okValue.includes(a):g=a===e.customCodeSet.okValue,!g)throw new E({message:c[e.customCodeSet.messageKey],status:f,customCode:a,config:s})}return c}catch(n){const u=new E({message:`${n.status?"":"网络异常，请检查是否有网后再试-"}${n.message||n.errMsg||""}`,status:n.status,customCode:n.customCode,config:s});throw typeof e.errorInterceptor=="function"?e.errorInterceptor(u):u}}}},W=()=>{console.log("uniapp不支持")},K=t=>{const e=uni.createIntersectionObserver(t,{observeAll:!0,nativeMode:!0});return{observer:s=>{const w={top:s.top||0,bottom:s.bottom||0,left:s.left||0,right:s.right||0};s.root?e.relativeTo(s.root,w):e.relativeToViewport(w),e.observe(s.selector,n=>{n.intersectionRatio>0&&s.callback&&s.callback(n.dataset)})},disconnect:()=>e.disconnect()}};h.RequestError=E,h.ZhuanpanPosition=D,h.ZhuanpanStatus=M,h.useCountDown=$,h.useCountTo=Z,h.useIntersectionObserver=K,h.useRequest=x,h.useRequestAnimationFrame=P,h.useWeixinJsConfig=W,h.useZhuanpan=U,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
